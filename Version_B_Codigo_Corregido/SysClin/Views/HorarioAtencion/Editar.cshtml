@model SysClin.Models.ViewModel.HorarioAtencionViewModel

@{
    ViewBag.Title = "Editar horario";
    Layout = ViewBag.Layout;
}

<h2>Editar horario de atención</h2>
<hr />

<small class="text-muted d-block mb-3">
    Los horarios se configuran en formato de 24 horas.
    Puede registrar varios bloques por día siempre que no se solapen.
    La duración corresponde al tiempo de cada espacio de atención (por ejemplo, 20 o 30 minutos).
    El intervalo entre la hora de inicio y la hora de fin debe poder dividirse en espacios del mismo tamaño.
</small>

@using (Html.BeginForm("Editar", "HorarioAtencion", FormMethod.Post))
{
    @Html.AntiForgeryToken()
    @Html.HiddenFor(m => m.ID_Horario)
    @Html.HiddenFor(m => m.ID_Usuario)

    @Html.ValidationSummary(true, "", new { @class = "text-danger mb-3" })

    <div class="card shadow-sm">
        <div class="card-body">

            @Html.LabelFor(m => m.Dia_Semana)
            @Html.DropDownListFor(
                m => m.Dia_Semana,
                (IEnumerable<SelectListItem>)ViewBag.DiasSemana,
                new { @class = "form-control" })
            @Html.ValidationMessageFor(m => m.Dia_Semana, "", new { @class = "text-danger mb-3 d-block" })

            @Html.LabelFor(m => m.Hora_Inicio)
            @Html.TextBoxFor(m => m.Hora_Inicio, new { @class = "form-control", type = "time" })
            @Html.ValidationMessageFor(m => m.Hora_Inicio, "", new { @class = "text-danger mb-3 d-block" })

            @Html.LabelFor(m => m.Hora_Fin)
            @Html.TextBoxFor(m => m.Hora_Fin, new { @class = "form-control", type = "time" })
            @Html.ValidationMessageFor(m => m.Hora_Fin, "", new { @class = "text-danger mb-3 d-block" })

            @Html.Label("Duración por espacio (minutos)")
            @Html.DropDownListFor(
                m => m.Duracion_Minutos,
                new SelectList(ViewBag.Duraciones, "Value", "Text", Model.Duracion_Minutos),
                "-- Seleccione --",
                new { @class = "form-control" })
            @Html.ValidationMessageFor(m => m.Duracion_Minutos, "", new { @class = "text-danger mb-3 d-block" })

            <div class="mt-3">
                <button type="submit" class="btn btn-warning">Actualizar</button>
                <button type="button" class="btn btn-outline-secondary"
                        onclick="location.href='@Url.Action("Index", "HorarioAtencion")'">
                    Cancelar
                </button>
            </div>
        </div>
    </div>
}

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    @if (ViewBag.Editado != null && (bool)ViewBag.Editado)
    {
        <script>
            Swal.fire({
                icon: 'success',
                title: 'Horario actualizado',
                text: 'Los cambios se guardaron correctamente.'
            }).then(() => {
                window.location.href = '@Url.Action("Index", "HorarioAtencion")';
            });
        </script>
    }
}
