@model SysClin.Models.ViewModel.HorarioAtencionViewModel

@{
    ViewBag.Title = "Crear horario";
    Layout = ViewBag.Layout;
}

<h2>Crear horario de atención</h2>
<hr />

<small class="text-muted d-block mb-3">
    Los horarios se configuran en formato de 24 horas.
    Puede registrar varios bloques por día siempre que no se solapen.
    La duración corresponde al tiempo de cada espacio de atención (por ejemplo, 20 o 30 minutos).
    El intervalo entre la hora de inicio y la hora de fin debe poder dividirse en espacios del mismo tamaño.
</small>

@using (Html.BeginForm("Crear", "HorarioAtencion", FormMethod.Post))
{
    @Html.AntiForgeryToken()
    @Html.ValidationSummary(true, "", new { @class = "text-danger mb-3" })
    @Html.HiddenFor(m => m.ID_Usuario)

    <div class="card shadow-sm">
        <div class="card-body">

            @Html.LabelFor(m => m.Dia_Semana)
            @Html.DropDownListFor(
                m => m.Dia_Semana,
                (IEnumerable<SelectListItem>)ViewBag.DiasSemana,
                "-- Seleccione un día --",
                new { @class = "form-control" })
            @Html.ValidationMessageFor(m => m.Dia_Semana, "", new { @class = "text-danger mb-3 d-block" })

            @Html.LabelFor(m => m.Hora_Inicio)
            @Html.TextBoxFor(m => m.Hora_Inicio, new { @class = "form-control", type = "time" })
            @Html.ValidationMessageFor(m => m.Hora_Inicio, "", new { @class = "text-danger mb-3 d-block" })

            @Html.LabelFor(m => m.Hora_Fin)
            @Html.TextBoxFor(m => m.Hora_Fin, new { @class = "form-control", type = "time" })
            @Html.ValidationMessageFor(m => m.Hora_Fin, "", new { @class = "text-danger mb-3 d-block" })

            @Html.Label("Duración por espacio (minutos)")
            @Html.DropDownListFor(
                m => m.Duracion_Minutos,
                new SelectList(ViewBag.Duraciones, "Value", "Text"),
                "-- Seleccione --",
                new { @class = "form-control" })
            @Html.ValidationMessageFor(m => m.Duracion_Minutos, "", new { @class = "text-danger mb-3 d-block" })

            <div class="mt-3">
                <button type="submit" class="btn btn-success">Guardar</button>
                <button type="button" class="btn btn-outline-secondary"
                        onclick="location.href='@Url.Action("Index", "HorarioAtencion")'">
                    Cancelar
                </button>
            </div>
        </div>
    </div>
}

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    @if (ViewBag.Creado != null && (bool)ViewBag.Creado)
    {
        <script>
            Swal.fire({
                icon: 'success',
                title: 'Horario creado',
                text: 'El horario se ha registrado correctamente.'
            }).then(() => {
                window.location.href = '@Url.Action("Index", "HorarioAtencion")';
            });
        </script>
    }
}
